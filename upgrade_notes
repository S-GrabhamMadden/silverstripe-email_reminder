2020-11-30 01:09

# running php upgrade upgrade see: https://github.com/silverstripe/silverstripe-upgrader
cd /var/www/upgrades/email-reminder
php /var/www/upgrades/upgrader_tool/vendor/silverstripe/upgrader/bin/upgrade-code upgrade /var/www/upgrades/email-reminder/email_reminder  --root-dir=/var/www/upgrades/email-reminder --write -vvv
Writing changes for 7 files
Running upgrades on "/var/www/upgrades/email-reminder/email_reminder"
[2020-11-30 13:09:18] Applying RenameClasses to _config.php...
[2020-11-30 13:09:18] Applying ClassToTraitRule to _config.php...
[2020-11-30 13:09:18] Applying RenameClasses to EmailReminderTest.php...
[2020-11-30 13:09:18] Applying ClassToTraitRule to EmailReminderTest.php...
[2020-11-30 13:09:18] Applying RenameClasses to EmailReminder_DailyMailOut.php...
[2020-11-30 13:09:18] Applying ClassToTraitRule to EmailReminder_DailyMailOut.php...
[2020-11-30 13:09:18] Applying RenameClasses to EmailReminder_ReplacerClassBase.php...
[2020-11-30 13:09:18] Applying ClassToTraitRule to EmailReminder_ReplacerClassBase.php...
[2020-11-30 13:09:18] Applying RenameClasses to EmailReminder_NotificationSchedule.php...
[2020-11-30 13:09:18] Applying ClassToTraitRule to EmailReminder_NotificationSchedule.php...
[2020-11-30 13:09:18] Applying RenameClasses to EmailReminder_EmailRecord.php...
[2020-11-30 13:09:18] Applying ClassToTraitRule to EmailReminder_EmailRecord.php...
[2020-11-30 13:09:18] Applying RenameClasses to EmailReminder_ReplacerClassInterface.php...
[2020-11-30 13:09:18] Applying ClassToTraitRule to EmailReminder_ReplacerClassInterface.php...
[2020-11-30 13:09:18] Applying RenameClasses to EmailReminder_MailOutInterface.php...
[2020-11-30 13:09:18] Applying ClassToTraitRule to EmailReminder_MailOutInterface.php...
[2020-11-30 13:09:18] Applying RenameClasses to EmailReminder_Mailer.php...
[2020-11-30 13:09:18] Applying ClassToTraitRule to EmailReminder_Mailer.php...
[2020-11-30 13:09:18] Applying RenameClasses to EmailReminder_ModelAdmin.php...
[2020-11-30 13:09:18] Applying ClassToTraitRule to EmailReminder_ModelAdmin.php...
modified:	tests/EmailReminderTest.php
@@ -1,4 +1,6 @@
 <?php
+
+use SilverStripe\Dev\SapphireTest;

 class EmailReminderTest extends SapphireTest
 {

modified:	src/Tasks/EmailReminder_DailyMailOut.php
@@ -2,18 +2,34 @@

 namespace SunnySideUp\EmailReminder\Tasks;

-use BuildTask;
-use EmailReminder_MailOutInterface;
-use Email;
-use EmailReminder_Mailer;
-use EmailReminder_NotificationSchedule;
-use Config;
-use DataObject;
-use Injector;
-use EmailReminder_EmailRecord;
-use ArrayData;
-use ShortcodeParser;
-use SSViewer;
+
+
+
+
+
+
+
+
+
+
+
+
+use SunnySideUp\EmailReminder\Api\EmailReminder_ReplacerClassBase;
+use SunnySideUp\EmailReminder\Email\EmailReminder_Mailer;
+use SilverStripe\Control\Email\Email;
+use SunnySideUp\EmailReminder\Model\EmailReminder_NotificationSchedule;
+use SilverStripe\Core\Config\Config;
+use SunnySideUp\EmailReminder\Tasks\EmailReminder_DailyMailOut;
+use SilverStripe\ORM\DataObject;
+use SilverStripe\Core\Injector\Injector;
+use SunnySideUp\EmailReminder\Model\EmailReminder_EmailRecord;
+use SilverStripe\View\ArrayData;
+use SunnySideUp\EmailReminder\Interfaces\EmailReminder_ReplacerClassInterface;
+use SilverStripe\View\Parsers\ShortcodeParser;
+use SilverStripe\View\SSViewer;
+use SilverStripe\Dev\BuildTask;
+use SunnySideUp\EmailReminder\Interfaces\EmailReminder_MailOutInterface;
+



@@ -29,7 +45,7 @@
     /**
      * @var string
      */
-    private static $replacer_class = 'EmailReminder_ReplacerClassBase';
+    private static $replacer_class = EmailReminder_ReplacerClassBase::class;


     protected $verbose = false;
@@ -116,7 +132,7 @@
                     }
                 }
             } else {
-                $limit = Config::inst()->get('EmailReminder_DailyMailOut', 'daily_limit');
+                $limit = Config::inst()->get(EmailReminder_DailyMailOut::class, 'daily_limit');
                 $records = $reminder->CurrentRecords();
                 $records = $records->limit($limit);
                 if ($records) {
@@ -203,10 +219,10 @@
     public function getReplacerObject()
     {
         if (! $this->replacerObject) {
-            $replacerClass = Config::inst()->get("EmailReminder_DailyMailOut", "replacer_class");
+            $replacerClass = Config::inst()->get(EmailReminder_DailyMailOut::class, "replacer_class");
             if ($replacerClass && class_exists($replacerClass)) {
                 $interfaces = class_implements($replacerClass);
-                if ($interfaces && in_array('EmailReminder_ReplacerClassInterface', $interfaces)) {
+                if ($interfaces && in_array(EmailReminder_ReplacerClassInterface::class, $interfaces)) {
                     $this->replacerObject = Injector::inst()->get($replacerClass);
                 }
             }

modified:	src/Api/EmailReminder_ReplacerClassBase.php
@@ -2,9 +2,13 @@

 namespace SunnySideUp\EmailReminder\Api;

-use ViewableData;
-use EmailReminder_ReplacerClassInterface;
-use Director;
+
+
+
+use SilverStripe\Control\Director;
+use SilverStripe\View\ViewableData;
+use SunnySideUp\EmailReminder\Interfaces\EmailReminder_ReplacerClassInterface;
+




modified:	src/Model/EmailReminder_NotificationSchedule.php
@@ -2,19 +2,43 @@

 namespace SunnySideUp\EmailReminder\Model;

-use DataObject;
-use Config;
-use CheckboxField;
-use DropdownField;
-use NumericField;
-use TextField;
-use HTMLEditorField;
-use TextareaField;
-use GridField;
-use LiteralField;
-use ClassInfo;
-use Injector;
-use BuildTask;
+
+
+
+
+
+
+
+
+
+
+
+
+
+use SilverStripe\Security\Member;
+use SilverStripe\Control\Email\Email;
+use SunnySideUp\EmailReminder\Tasks\EmailReminder_DailyMailOut;
+use SunnySideUp\EmailReminder\Model\EmailReminder_EmailRecord;
+use SilverStripe\Core\Config\Config;
+use SilverStripe\Forms\CheckboxField;
+use SilverStripe\ORM\DataObject;
+use SilverStripe\Forms\DropdownField;
+use SilverStripe\Forms\EmailField;
+use SilverStripe\Forms\DateField;
+use SilverStripe\Forms\NumericField;
+use SilverStripe\Forms\TextField;
+use SilverStripe\Forms\HTMLEditor\HTMLEditorField;
+use SilverStripe\Forms\TextareaField;
+use SilverStripe\Forms\GridField\GridFieldAddExistingAutocompleter;
+use SilverStripe\Forms\GridField\GridField;
+use SilverStripe\Forms\LiteralField;
+use SilverStripe\Core\ClassInfo;
+use SilverStripe\ORM\FieldType\DBDate;
+use SilverStripe\Core\Injector\Injector;
+use SilverStripe\Dev\BuildTask;
+use SunnySideUp\EmailReminder\Cms\EmailReminder_ModelAdmin;
+use SunnySideUp\EmailReminder\Model\EmailReminder_NotificationSchedule;
+


 class EmailReminder_NotificationSchedule extends DataObject
@@ -28,7 +52,7 @@
     /**
      * @var string
      */
-    private static $default_data_object = 'Member';
+    private static $default_data_object = Member::class;

     /**
      * @var string
@@ -43,7 +67,7 @@
     /**
      * @var string
      */
-    private static $replaceable_record_fields = array('FirstName', 'Surname', 'Email');
+    private static $replaceable_record_fields = array('FirstName', 'Surname', Email::class);

     /**
      * @var string
@@ -58,7 +82,7 @@
     /**
      * @var string
      */
-    private static $mail_out_class = 'EmailReminder_DailyMailOut';
+    private static $mail_out_class = EmailReminder_DailyMailOut::class;

     /**
      * @var string
@@ -107,7 +131,7 @@


     private static $has_many = array(
-        'EmailsSent' => 'EmailReminder_EmailRecord'
+        'EmailsSent' => EmailReminder_EmailRecord::class
     );

     private static $summary_fields = array(
@@ -132,7 +156,7 @@
         $this->Days = 7;
         $this->RepeatDays = 300;
         $this->BeforeAfter = 'before';
-        $this->EmailFrom = Config::inst()->get('Email', 'admin_email');
+        $this->EmailFrom = Config::inst()->get(Email::class, 'admin_email');
         $this->EmailSubject = 'Your memberships expires in [days] days';
     }

@@ -151,14 +175,14 @@
         $fields->addFieldToTab(
             'Root.Main',
             $dataObjecField = DropdownField::create(
-                'DataObject',
+                DataObject::class,
                 'Table/Class Name',
                 $this->dataObjectOptions()
             )
             ->setRightTitle('Type a valid table/class name')
         );
         if ($this->Config()->get('default_data_object')) {
-            $fields->replaceField('DataObject', $dataObjecField->performReadonlyTransformation());
+            $fields->replaceField(DataObject::class, $dataObjecField->performReadonlyTransformation());
         }


@@ -166,7 +190,7 @@
         $fields->addFieldToTab(
             'Root.Main',
             $emailFieldField = DropdownField::create(
-                'EmailField',
+                EmailField::class,
                 'Email Field',
                 $this->emailFieldOptions()
             )
@@ -174,13 +198,13 @@
             ->setEmptyString('[ Please select ]')
         );
         if ($this->Config()->get('default_email_field')) {
-            $fields->replaceField('EmailField', $emailFieldField->performReadonlyTransformation());
+            $fields->replaceField(EmailField::class, $emailFieldField->performReadonlyTransformation());
         }

         $fields->addFieldToTab(
             'Root.Main',
             $dateFieldField = DropdownField::create(
-                'DateField',
+                DateField::class,
                 'Date Field',
                 $this->dateFieldOptions()
             )
@@ -188,7 +212,7 @@
             ->setEmptyString('[ Please select ]')
         );
         if ($this->Config()->get('default_date_field')) {
-            $fields->replaceField('DateField', $dateFieldField->performReadonlyTransformation());
+            $fields->replaceField(DateField::class, $dateFieldField->performReadonlyTransformation());
         }

         $fields->removeFieldsFromTab(
@@ -278,7 +302,7 @@
         );
         if ($emailsSentField) {
             $config = $emailsSentField->getConfig();
-            $config->removeComponentsByType('GridFieldAddExistingAutocompleter');
+            $config->removeComponentsByType(GridFieldAddExistingAutocompleter::class);
             $fields->addFieldToTab(
                 'Root.Sent',
                 $emailsSentField
@@ -315,7 +339,7 @@
      */
     protected function dataObjectOptions()
     {
-        return ClassInfo::subclassesFor("DataObject");
+        return ClassInfo::subclassesFor(DataObject::class);
     }

     /**
@@ -323,7 +347,7 @@
      */
     protected function emailFieldOptions()
     {
-        return $this->getFieldsFromDataObject(array('Varchar', 'Email'));
+        return $this->getFieldsFromDataObject(array('Varchar', Email::class));
     }

     /**
@@ -331,7 +355,7 @@
      */
     protected function dateFieldOptions()
     {
-        return $this->getFieldsFromDataObject(array('Date'));
+        return $this->getFieldsFromDataObject(array(DBDate::class));
     }


@@ -533,7 +557,7 @@

     public function CMSEditLink()
     {
-        $controller = singleton("EmailReminder_ModelAdmin");
+        $controller = singleton(EmailReminder_ModelAdmin::class);


 /**
@@ -649,7 +673,7 @@
     {
         if ($this->hasValidFields()) {
             $sign = $this->BeforeAfter == 'before' ? '+' : '-';
-            $graceDays = Config::inst()->get('EmailReminder_NotificationSchedule', 'grace_days');
+            $graceDays = Config::inst()->get(EmailReminder_NotificationSchedule::class, 'grace_days');

             if ($sign == '+') {
                 $minDays = $sign . ($this->Days - $graceDays) . ' days';

Warnings for src/Model/EmailReminder_NotificationSchedule.php:
 - src/Model/EmailReminder_NotificationSchedule.php:523 PhpParser\Node\Expr\Variable
 - WARNING: New class instantiated by a dynamic value on line 523

 - src/Model/EmailReminder_NotificationSchedule.php:578 PhpParser\Node\Expr\Variable
 - WARNING: New class instantiated by a dynamic value on line 578

 - src/Model/EmailReminder_NotificationSchedule.php:629 PhpParser\Node\Expr\Variable
 - WARNING: New class instantiated by a dynamic value on line 629

modified:	src/Model/EmailReminder_EmailRecord.php
@@ -2,8 +2,12 @@

 namespace SunnySideUp\EmailReminder\Model;

-use DataObject;
-use LiteralField;
+
+
+use SunnySideUp\EmailReminder\Model\EmailReminder_NotificationSchedule;
+use SilverStripe\Forms\LiteralField;
+use SilverStripe\ORM\DataObject;
+


 class EmailReminder_EmailRecord extends DataObject
@@ -52,7 +56,7 @@
     );

     private static $has_one = array(
-        'EmailReminder_NotificationSchedule' => 'EmailReminder_NotificationSchedule'
+        'EmailReminder_NotificationSchedule' => EmailReminder_NotificationSchedule::class
     );

     private static $summary_fields = array(

modified:	src/Email/EmailReminder_Mailer.php
@@ -2,9 +2,14 @@

 namespace SunnySideUp\EmailReminder\Email;

-use Mailer;
-use Director;
-use Config;
+
+
+
+use SilverStripe\Control\Director;
+use SilverStripe\Core\Config\Config;
+use SunnySideUp\EmailReminder\Email\EmailReminder_Mailer;
+use SilverStripe\Control\Email\Mailer;
+



@@ -21,7 +26,7 @@
         $customheaders = false,
         $plainContent = false
     ) {
-        $cssFileLocation = Director::baseFolder() .'/'. Config::inst()->get("EmailReminder_Mailer", "css_file");
+        $cssFileLocation = Director::baseFolder() .'/'. Config::inst()->get(EmailReminder_Mailer::class, "css_file");
         if ($cssFileLocation) {
             if (file_exists($cssFileLocation)) {
                 $cssFileHandler = fopen($cssFileLocation, 'r');

modified:	src/Cms/EmailReminder_ModelAdmin.php
@@ -2,12 +2,15 @@

 namespace SunnySideUp\EmailReminder\Cms;

-use ModelAdmin;
+
+use SunnySideUp\EmailReminder\Model\EmailReminder_NotificationSchedule;
+use SilverStripe\Admin\ModelAdmin;
+


 class EmailReminder_ModelAdmin extends ModelAdmin
 {
-    public static $managed_models = array('EmailReminder_NotificationSchedule');
+    public static $managed_models = array(EmailReminder_NotificationSchedule::class);

     public static $url_segment = 'emailreminders';


Writing changes for 7 files
✔✔✔